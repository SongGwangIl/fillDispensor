<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.ac.kopo.schedule.service.impl.ScheduleDAO">
	<resultMap type="ScheduleVO" id="scheduleMap">
		<id column="sche_id" property="scheId"/>
		<result column="user_id" property="userId"/>
		<result column="sche_title" property="scheTitle"/>
		<result column="sche_select" property="scheSelect"/>
		<result column="sche_start_date" property="scheStartDate"/>
		<result column="sche_end_date" property="scheEndDate"/>
		<result column="sche_date_expires" property="scheDateExpires"/>
		<result column="sche_take_num"  property="scheTakeNum" />
		<result column="sche_hide" property="scheHide"  />
		
		<collection property="timeList" ofType="ScheTimeVO" column="sche_id" select="findAllByScheId">
			<id property="timeId" column="timeId" />
			<result property="scheId" column="scheId" />
			<result property="timeName" column="timeName" />
			<result property="timeAlarm" column="timeAlarm" />
			<result property="timeLimit" column="timeLimit" />
			<result property="reAlarmCount" column="reAlarmCount" />
			<result property="reAlarmTime" column="reAlarmTime" />
			<result property="medLocation" column="medLocation" />
			<result property="timeHide" column="timeHide" />
		</collection>
	</resultMap>
	
	<select id="list" resultMap="scheduleMap">
		SELECT * FROM SCHEDULE
		WHERE USER_ID=#{userId} AND SCHE_HIDE='N'
		ORDER BY SCHE_ID DESC
	</select>
	
	<select id="findAllByScheId" resultType="ScheTimeVO">
		SELECT * FROM SCHE_TIME
		WHERE SCHE_ID = #{scheId} AND TIME_HIDE='N'
	</select>

	<insert id="add">
		INSERT INTO SCHEDULE (
			SCHE_ID
			, USER_ID
			, SCHE_TITLE
			, SCHE_TAKE_NUM
			, SCHE_SELECT
			, SCHE_START_DATE
			, SCHE_END_DATE
		) VALUES (
			CONCAT('SCHE_', LPAD(NEXT VALUE FOR SQ_SCHE, 5, '0'))
			, #{userId}
			, #{scheTitle}
			, #{scheTakeNum}
			, #{scheSelect}
			, #{scheStartDate}
			, #{scheEndDate}
			)
	</insert>
	
	<select id="findById">
		SELECT * FROM SCHEDULE
		WHERE SCHE_ID=#{scheId}
	</select>
	
	<delete id="delete">
		UPDATE SCHEDULE
		SET SCHE_HIDE='Y'
		WHERE SCHE_ID=#{scheId}
	</delete>
	
	<update id="edit">
		UPDATE SCHEDULE
		SET 
		    SCHE_TITLE = #{scheTitle},
		    SCHE_SELECT = #{scheSelect},
		    SCHE_START_DATE = #{scheStartDate},
		    SCHE_END_DATE = #{scheEndDate}
		WHERE 
		    SCHE_ID = #{scheId}
	</update>
</mapper>